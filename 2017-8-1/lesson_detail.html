<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="telephone=no,email=no" name="format-detection" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>

    <!-- 7E css -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/loading.css">
    <!-- Element-UI css -->
    <link rel="stylesheet" href="css/element-ui@1.2.4.css">
    <!-- 7E js -->
    <script src="js/jquery-2.1.4.js"></script>
    <script src="js/vue.js"></script>
    <!-- Element-UI js -->
    <script src="js/element-ui@1.2.4.js"></script>
    <script src="js/vue-component.js"></script>
    <script src="layer/layer.js"></script>
    <script src="js/base.js?v=28"></script>
    <script src="js/interface.js?v=31"></script>
    <script src="js/md5.js"></script>
    <script src="js/sha1.js"></script>
    <script src="js/sign.js"></script>
    <script src="js/loading.js"></script>
    <!--<script src="js/checkLogin.js"></script>-->

    <title>课程详情</title>
</head>
<body>

<!--
| ------------------------------------------
| lesson_detail_page
| ------------------------------------------
| Here are lesson_detail_page html
|
-->
<div id="lesson_detail_page">

    <!--<layout-loader-black :show="loading"></layout-loader-black>-->

    <!--<layout-loader :show="showLoader"></layout-loader>-->
    <div class="loader">
        <div class="loader-content">
            <img src="images/loading.gif" alt="Loader" class="loader-loader" />
        </div>
    </div>

    <!--<en-pay ref="enPay" :phone="channel.isUserTips" :gold="channel.salesPrice >= 0" :item="channel" v-on:callback="payCallback" v-on:callbackfail="payCallbackFail" v-on:payload="payIng"></en-pay>-->
    <div class="wb100" ref="enPay">
        <template v-if="recharge">
            <div style="background: #fff; width: 100%; height: 100%; position: fixed; z-index: 999999999; display: none; top:0; left:0;">
                <div class="wb100 h50px relative" style="z-index: 99999;">
                    <div style="height: 24px; width:24px; float: left; margin-top: 13px;" class="img-area mal15"><img src="images/icon-back1.png" @click="closeRecharge"></div>
                    <p class="wb70 text-over-hidden1 absolute text-center h50px lh50px F16 Fgray-4" style="top: 0; left: 0; right: 0; margin: 0 auto;">充值</p>
                </div>
                <div class="pa15">
                    <p class="h20px lh20px pat10 pab10 mab15 radius5" v-bind:class="current == key ? 'gold-buy-active' : 'gold-buy'" v-for="(channel,key) in golds" @click="selectPrice(key)">

                        <span class="fl mal15">{{channel.coinQty}}金币</span>
                        <span class="Fyellow2 fl" v-if="channel.giftCoinQty>0">+{{channel.giftCoinQty}}金币</span>
                        <span class="fr w80px text-center" style="border-left: 1px solid #e8e8e8; ">{{channel.price}}元</span>
                    </p>
                </div>
                <div class="pa15">
                <div class="clear h20px"></div>
                <div class="wb100 Fgray-2 F14 lh20px">
                    <p class="Fgray-3 F16">温馨提示：</p>
                    <div class="clear1"></div>
                    <p class="mat5">1、充值金额只用作于7天英语中与老师的费用，不包含您的网络费用。</p>
                    <p class="mat5">2、充值金额没有时间使用期限，会一直在您的7天英语账户中，可以随时使用。</p>
                    <p class="mat5">3、充值金额不支持退换。</p>
                </div>
                </div>
            </div>
        </template>
        <template v-else>
            <div class="cs-loader" v-show="showBg" style="background: rgba(0,0,0,.8); z-index: 9999999" @click="closePay"></div>
            <div :style="payStyle">
                <div class="pa15">

                    <template v-if="isVip == true">

                        <div class="wb100">
                            <div class="clear1"></div>

                            <p style="color:#f6a623;" class="text-center">每天三角钱，英语轻松学</p>

                            <div class="clear1"></div>

                            <div class="wb100 pat15 pab15 lh25px text-center" style="color:#925421; background:#ffd7bf;">
                                <p>付费精品课程全场免费</p>
                                <p class="F12 lh20px">课程价值上万元，优质课程持续更新中</p>
                            </div>

                            <div class="clear1"></div>

                            <div class="wb100 pat15 pab15 lh25px text-center" style="color:#a47e3f; background:#feebca;">
                                <p>直播课程无限畅学</p>
                            </div>

                            <div class="clear1"></div>

                            <div class="wb100 pat15 pab15 lh25px text-center" style="color:#83a78b; background:#d3f1d9;">
                                <p>VIP高速下载通道</p>
                            </div>

                            <div class="clear1"></div>


                            <div class="clear1"></div>

                            <div class="wb100" v-if="vipData.currencyType == 0">

                                <p>超值特价：{{vipData.salesAmount}}金币/年，原价{{vipData.marketAmount}}金币/年

                                <p class="h30px lh30px text-over-hidden1">余额：{{ user.goldCoinsQty ? user.goldCoinsQty : 0}} 金币</p>

                                <div class="clear1"></div>

                                <a href="javascript:void(0)" v-if="user.goldCoinsQty && user.goldCoinsQty > vipData.salesAmount" @click="buyVip('gold')" class="display-inline h45px lh45px text-center Fwhite warpper-blue wb100 F16 radius5">
                                    <span class="Fwhite">确认支付</span>
                                </a>
                                <a href="javascript:void(0)" @click="openRecharge" v-else class="display-inline h45px lh45px text-center Fwhite warpper-blue wb100 F16 radius5">
                                    <span class="Fwhite">余额不足，请充值</span>
                                </a>

                            </div>

                            <div class="wb100" v-else>

                                <p>超值特价：{{ twoDecimal(vipData.salesAmount)}}元/年，原价{{ twoDecimal(vipData.marketAmount)}}元/年

                                <div class="clear1"></div>

                                <a href="javascript:void(0)" @click="buyVip" class="display-inline h45px lh45px text-center Fwhite warpper-blue wb100 F16 radius5">
                                    <span class="Fwhite">确认支付</span>
                                </a>
                            </div>

                        </div>

                    </template>

                    <template v-else>

                        <div class="wb100 Fgray-4" v-if="channel.salesPrice >= 0">
                            <p class="h30px lh30px text-over-hidden1">频道名：{{channel.channelName}}</p>
                            <p class="h30px lh30px text-over-hidden1">价格：<span class="Forange">{{channel.payGoldCoins}}</span> 金币</p>
                            <p class="h30px lh30px text-over-hidden1">余额：{{ user.goldCoinsQty ? user.goldCoinsQty : 0}} 金币</p>
                            <div class="clear1"></div>
                            <template v-if="channel.isUserTips">
                                <el-input v-model="phoneNum" placeholder="请输入手机号"></el-input>
                                <div class="clear1"></div>
                            </template>
                            <a href="javascript:void(0)" v-if="user.goldCoinsQty && user.goldCoinsQty > channel.payGoldCoins" @click="goldPay" class="display-inline h45px lh45px text-center Fwhite warpper-blue wb100 F16 radius5">
                                <span class="Fwhite">确认支付</span>
                            </a>
                            <a href="javascript:void(0)" @click="openRecharge" v-else class="display-inline h45px lh45px text-center Fwhite warpper-blue wb100 F16 radius5">
                                <span class="Fwhite">余额不足，请充值</span>
                            </a>
                        </div>
                        <div class="wb100" v-else>
                            <p class="h30px lh30px text-over-hidden1">频道名：{{channel.channelName}}</p>
                            <p class="h30px lh30px text-over-hidden1">价格：¥<span class="Forange">{{channel.salesPrice / 100}}</span> 元</p>
                            <div class="clear1"></div>
                            <template v-if="channel.isUserTips">
                                <el-input v-model="name" placeholder="请输入姓名"></el-input>
                                <div class="clear1"></div>
                                <el-input v-model="phoneNum" placeholder="请输入手机号"></el-input>
                                <div class="clear1"></div>
                            </template>
                            <a href="javascript:void(0)" @click="wxPay" class="display-inline h45px lh45px text-center Fwhite warpper-blue wb100 F16 radius5" data-role="none">
                                <span class="Fwhite">确认支付</span>
                            </a>
                        </div>

                    </template>

                </div>
            </div>
        </template>
    </div>


<!---->
    <div class="lesson_detail_page_content hidden wb100">

        <div class="dialogBg" @click="closeComment"></div>

        <div class="commBg" style="width: 300px; display: none; z-index: 999999; height: 200px; background: #fff; position: fixed; top: 0; left: 0; right: 0; bottom: 0; margin: auto; padding: 15px; border: 1px solid #e1e1e1;">
            <p class="h30px lh30px">添加评论</p>

            <div class="clear1"></div>

            <el-input
                    type="textarea"
                    :rows="4"
                    placeholder="请输入内容"
                    v-model="commentVal">
            </el-input>

            <div class="clear1"></div>

            <div class="wb100 h40px lh40px warpper-blue Fwhite F16 text-center radius5" @click="submitComment">评论</div>

        </div>

        <div class="wb100" v-if="!isPlay">

            <div class="wb100 h265px over-hidden relative">

                <!--<en-header-new :back="true" :home="true" :white="false"></en-header-new>-->
                <!--<div class="wb100 h50px relative" style="z-index: 99999;" >-->

                    <!--<div  style="height: 24px; padding: 13px 15px;">-->

                        <!--&lt;!&ndash;<div style="height: 24px; width:24px; float: left;" class="img-area"><img src="images/icon-back2.png"  @click="myBack"></div>&ndash;&gt;-->
                        <!--<a href="index.html"  class="fr"><div style="height: 24px; width:24px;" class="img-area"><img src="images/icon-home2.png"></div></a>-->

                        <!--<p class="wb70 text-over-hidden1 absolute text-center h50px lh50px F16" style="top: 0; left: 0; right: 0; margin: 0 auto; color: #fff;"></p>-->
                    <!--</div>-->
                <!--</div>-->

                <img :src="channel.iconURL + '?x-oss-process=image/resize,m_fill,h_220,w_'+width" class="img-filter40" />

                <div style="background: rgba(0,0,0,.1); top: 0; left: 0; z-index: 9;" class="wb100 h220px absolute"></div>

                <div  class="absolute w280px text-center" style="left: 0; right: 0; top: 25px; margin: 0 auto; z-index: 999;">

                    <div class="w120px h120px img-area center">
                        <img :src="channel.iconURL + '?x-oss-process=image/resize,m_fixed,h_240,w_240'" />
                    </div>

                    <p class="lh30px h30px F20 mat10 center text-over-hidden1 Fgray-3 Fb">{{channel.channelName}}</p>
                    <p class="lh20px F14 Fgray-3 center text-over-hidden2 mat5">{{channel.subtitle}}</p>
                    <p class="lh20px F12 Fgray-2 center text-over-hidden2 mat10">{{channel.openCount}}个人在学</p>
                </div>

                <div class="wb120 h265px warpper-white absolute radius50per" style="z-index: 99; bottom: -110px; left: -10%;"></div>
            </div>

        </div>

        <div class="wb100 video-area" v-else>

            <div class="wb100 fixed warpper-black" :style="'height: '+ parseInt(Math.ceil(width*0.6) + 50) +'px; top:0;left:0; z-index:99;'">
                <!--<en-header-new :back="true" :home="true" :white="false" :title="playList[currentVideo].lessonName"></en-header-new>-->
                <div class="wb100 h50px relative" style="z-index: 99999;">
                    <div style="height: 24px; padding: 13px 15px;">

                        <!--<div style="height: 24px; width:24px; float: left;" class="img-area"><img src="images/icon-back2.png" @click="myBack"></div>-->
                        <a href="index.html" class="fr"><div style="height: 24px; width:24px;" class="img-area"><img src="images/icon-home2.png"></div></a>

                        <p class="wb70 text-over-hidden1 absolute text-center h50px lh50px F16" style="top: 0; left: 0; right: 0; margin: 0 auto; color: #fff;">{{playList[currentVideo].lessonName}}</p>
                    </div>
                </div>


                <video v-if="isM3u8" :src="videoUrl" class="wb100" webkit-playsinline playsinline controls :style="'height: '+ Math.ceil(width*0.6) +'px;'">
                </video>
                <div class="wb100" v-else v-html="videoHtml" :style="'height: '+ Math.ceil(width*0.6) +'px;'"></div>
            </div>

            <div class="wb100" :style="'height: '+ parseInt(Math.ceil(width*0.6) + 50) +'px;'"></div>

        </div>

        <div class="clear"></div>

        <div class="wb100">
            <div class="pal15 F14">
                <template v-for="(item,index) in playList">
                    <template v-if="buyed">
                        <div class="h45px lh45px text-over-hidden1 bor-gray bor-solid-1b F14 wb100" :class="index == currentVideo ? 'Fblue' : 'Fgray-4'" @click="playLesson(item,index)">
                            {{item.lessonName}}
                            <img src="images/icon-vipTag.png" v-if="isVip" style="position: absolute; width: 19px; height: 19px; top: 13px; right: 13px; z-index: 9;">
                        </div>
                    </template>
                    <template v-else>
                        <div v-if="index < channel.freeLessonNum" :class="index == currentVideo ? 'Fblue' : 'Fgray-4'" class="h45px lh45px text-over-hidden1 bor-gray bor-solid-1b F14" @click="playLesson(item,index)">
                            {{item.lessonName}}
                        </div>
                        <div v-else class="h45px lh45px text-over-hidden1 bor-gray bor-solid-1b Fgray-5 F14" @click="buyLesson">
                            {{item.lessonName}}
                        </div>
                    </template>
                </template>
            </div>
        </div>

        <div class="clear1"></div>

        <!--<div class="clear1 warpper-gray-1"></div>-->

        <!--<div class="pa15">-->
            <!--<p>-->
                <!--<span class="fl">评论</span>-->
                <!--<span class="fr Fblue" @click="openComment">我要评论 > </span>-->
            <!--</p>-->

            <!--<div class="clear1"></div>-->

            <!--<div class="wb100" v-for="(item,key) in comments">-->

                <!--<div class="wb100">-->

                    <!--<div class="w50px h100px fl">-->
                        <!--<div class="img-area w50px h50px relative">-->
                            <!--<img :src=" item.userIconURL ? item.userIconURL +'?x-oss-process=image/resize,m_fixed,h_100,w_100' : 'images/head-default.png'" class="radius50per" />-->
                            <!--<img src="images/img-vip.png" v-if="item.vip>0" style="position: absolute; width: 27px; height: 12px; margin: 0 auto; left: 0; right: 0; bottom:0; z-index: 9;">-->
                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="Fgray-3">-->
                        <!--<p class="lh30px h30px over-hidden pal15 F16 Fblack">-->
                            <!--<span class="fl Fred" v-if="item.vip>0">{{item.nickName}}</span>-->
                            <!--<span class="fl" v-else>{{item.nickName}}</span>-->
                            <!--<span class="fr Fgray-2 F14 mal5 mar15">({{item.praiseCount}})</span>-->
                            <!--<b class="img-area fr" style="width: 18px; height: 18px; margin-top: 2px;">-->
                                <!--<img src="images/icon-zaned.png" v-if="item.zaned">-->
                                <!--<img src="images/icon-zan.png" v-else @click="zan(item.commentID,key)" ref="refZan">-->
                            <!--</b>-->
                        <!--</p>-->
                        <!--<p class="lh30px h30px over-hidden pal15 F12 Fblack Fgray-2">{{item.commentTime}}</p>-->
                        <!--<p class="F14 lh20px h40px text-over-hidden2 pal15 par10">{{item.comment}}</p>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="clear1 bor-gray bor-solid-1b"></div>-->
                <!--<div class="clear1"></div>-->

            <!--</div>-->


            <!--<div class="clear"></div>-->

            <!--<div class="wb100" v-if="comments.length>0">-->
                <!--<a :href="'comments.html?channelID='+channelID"><p class="h30px lh30px Fgray-3 text-center">更多评论></p></a>-->
                <!--<div class="clear1"></div>-->
            <!--</div>-->

            <!--<div class="wb100" v-else>-->
                <!--<p class="h30px lh30px Fgray-2 text-center">暂无评论</p>-->
            <!--</div>-->

        <!--</div>-->

    </div>

    <template  v-if="channel.isBuy && buyed == false">

        <div class="wb100" style="position: fixed; bottom: 0; z-index: 99;">
            <div class="pal15 par15 pat10 pab10 lh25px warpper-white box-shadow-gray3 over-hidden">

                <div class="wb40 fl">
                    <div class="wb100" v-if="channel.salesPrice > 0">
                        <p class="Forange F20">¥{{ channel.salesPrice / 100 }}</p>
                        <p class="Fgray-2 FLine F14">原价：{{channel.marketPrice}}</p>

                    </div>
                    <div class="wb100" v-else>
                        <p class="Forange F20">{{channel.payGoldCoins}}金币</p>
                        <p class="Fgray-2 FLine F14">原价：{{channel.goldCoins}}金币</p>
                    </div>
                </div>

                <div class="wb60 fr mat5">
                    <div class="wb45 fl h40px lh40px warpper-blue Fwhite F16 text-center radius5" @click="buyLesson">加入学习</div>
                    <div class="wb45 fr h40px lh40px warpper-orange-2 Fwhite F16 text-center radius5" @click="buyLesson('vip')">成为VIP</div>
                </div>

                <div class="clear"></div>
            </div>
        </div>

        <div class="clear h70px"></div>

    </template>

    <en-statistics></en-statistics>

    <div class="isBuy"></div>


</div>



<script>

    var uTF8Encode = function uTF8Encode(string) {
        string = string.replace(/\x0d\x0a/g, "\x0a");
        var output = "";
        for (var n = 0; n < string.length; n++) {
            var c = string.charCodeAt(n);
            if (c < 128) {
                output += String.fromCharCode(c);
            } else if (c > 127 && c < 2048) {
                output += String.fromCharCode(c >> 6 | 192);
                output += String.fromCharCode(c & 63 | 128);
            } else {
                output += String.fromCharCode(c >> 12 | 224);
                output += String.fromCharCode(c >> 6 & 63 | 128);
                output += String.fromCharCode(c & 63 | 128);
            }
        }
        return output;
    };


    "use strict";

    var _data, _methods;

    function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

    var vm = new Vue({
        el: "#lesson_detail_page",
        data: (_data = {
            showLoader: true,
            loading: false,
            list: [],
            comments: [],
            channel: {},
            isDetail: true,
            isPlay: false,
            isRecharge: false,
            channelID: "",
            videoUrl: "",
            page: 1,
            pageSize: 3,
            width: 0,
            buyed: false,
            isVip: false,
            isM3u8: false,
            videoHtml: "",
            playList: [],
            currentVideo: -1,
            commentVal: "",

            name: "",
            phoneNum: "",
            user: {},
            current: 0,
            golds: [],
            recharge: false,
            showBg: false
        }, _defineProperty(_data, "isVip", false), _defineProperty(_data, "vipData", {}), _defineProperty(_data, "payStyle", {
            position: 'fixed',
            bottom: '-600px',
            left: 0,
            zIndex: 99999999,
            background: 'rgba(255,255,255,1)',
            width: '100%',
            overflow: 'hidden',
            transition: "all .5s",


            showResult: false,
            paymentNo: '',
            infoMsg: '',
            timerID: 0,
            timer: 0,
            state: '',

        }), _data),
        methods: (_methods = {

            myBack: function myBack(url) {
                window.history.go(-1);
            },

            closeRecharge: function closeRecharge() {
                this.recharge = false;
            },
            openRecharge: function openRecharge() {
                this.recharge = true;
            },
            selectPrice: function selectPrice(key) {
                this.current = key;
                this.pay();
            },
            twoDecimal: function twoDecimal(oNum) {
                var num = parseFloat(oNum);
                if (isNaN(length)) return false;

                var num = Math.round(oNum * 100) / 100;
                return num;
            },
            encodeUnicode: function encodeUnicode(str) {
                var res = [];
                for ( var i=0; i<str.length; i++ ) {
                    res[i] = ( "00" + str.charCodeAt(i).toString(16) ).slice(-4);
                }
                return "\\u" + res.join("\\u");
            },
            decodeUnicode: function decodeUnicode(str) {
                str = str.replace(/\\/g, "%");
                return unescape(str);
            },

            donePay: function donePay() {

                if (this.state == true) {
                    //充值成功
                    if (base.isNull(this.call)) {
                        window.location.replace('index.html');
                    } else {
                        window.history.go(-1);
                    }
                } else {
                    //充值失败
                    this.showResult = false;
                }
            },

            pay: function pay() {
                var _this = this;

                _this.loading = true;




//                baseAjax.getWxPayNew(_this.golds[_this.current].productID, function (data) {
//                    _this.loading = false;
//                    WeixinJSBridge.invoke('getBrandWCPayRequest', JSON.parse(data.returnJSON), function (res) {
//                        if (res.err_msg == "get_brand_wcpay_request:ok") {
//                            if (_this.isVip) {
//                                _this.buyVip('gold');
//                            } else {
//                                _this.goldPay();
//                            }
//                            _this.closeRecharge();
//                        } else {
//                            layer.alert("支付失败");
//                        }
//                    });
//                });



//            baseAjax.getAlipayWap('english6', function (data) {
//                _this.loading = false;
//
//
//                var index1 = data.indexOf('"out_trade_no":"');
//
//                var index2 = data.indexOf('",',index1);
//
//                var _str = data.substring(index1+16,index2);
//
//                base.setCookie('paymentNo', _str);
//                _this.paymentNo = _str;
//
//                data = data.replace('POST','GET');
//
////                $(".isBuy").html(data);
//
//                window.location.href='pay.html?data='+data;
//
//            });

//
                baseAjax.getAlipayWap(_this.golds[_this.current].productID, 'http://h5.7english.cn/newEs5_v2/new/lesson_detail.html?channelID='+_this.channelID, function (data) {
                    _this.loading = false;

                    var index1 = data.indexOf('"out_trade_no":"');

                    var index2 = data.indexOf('",',index1);

                    var _str = data.substring(index1+16,index2);

                    base.setCookie('paymentNo', _str);
                    _this.paymentNo = _str;

                    data = data.replace('POST','GET');

                    $(".isBuy").html(data);

                });


//                baseAjax.getAlipayWap('english6', window.location.href, function (data) {
//                    _this.loading = false;
//
//                    var index1 = data.indexOf('"out_trade_no":"');
//
//                    var index2 = data.indexOf('",',index1);
//
//                    var _str = data.substring(index1+16,index2);
//
//                    var dataIndex = base.getCookie('dataIndex');
//
//                    if(base.isNull(dataIndex)){
//                        dataIndex  = 0;
//                    }
//
//                    dataIndex ++;
//
//                    base.setCookie('dataIndex',dataIndex);
//
//                    base.setCookie('paymentNo', _str);
//                    _this.paymentNo = _str;
//
//                    data = data.replace('POST','GET');
//
//                    base.setCookie('data'+dataIndex, data);
//                    base.setCookie('abc', '123' + data);
//
//                    $(".isBuy").html(data);
//
//                });



            },
            closePay: function closePay() {
                this.payStyle.bottom = '-600px';
                this.showBg = false;

//
//                this.payCallback();

            },
            openPay: function openPay(vip) {

                var _this = this;

//                baseAjax.getAlipayWap('english6', 'http://h5.7english.cn/newEs5_v2/new/lesson_detail.html?channelID='+_this.channelID, function (data) {
//                    _this.loading = false;
//
//                    var index1 = data.indexOf('"out_trade_no":"');
//
//                    var index2 = data.indexOf('",',index1);
//
//                    var _str = data.substring(index1+16,index2);
//
//                    base.setCookie('paymentNo', _str);
//                    _this.paymentNo = _str;
//
//                    data = data.replace('POST','GET');
//
//                    $(".isBuy").html(data);
//
//                });


                var userInfo = base.getCookie("userInfo");

                if(!base.isNull(userInfo)){
                    userInfo = JSON.parse(base.getCookie("userInfo"));
                }

                if (base.isNull(userInfo)) {
                    if (base.versions.isWeiXin) {
                        layer.confirm('您还没有登录，前去登录吗？', {
                            btn: ['好的', '取消'] //按钮
                        }, function () {
                            //前去登录
                            var call = window.location.href;
                            window.location.href = 'wx_login.html?call=' + call;
                        }, function () {
                            //取消登录
                        });
                    } else {
                        layer.confirm('您还没有登录，前去登录吗？', {
                                btn: ['好的', '取消'] //按钮
                            }, function () {
                                //前去登录
                                var call = window.location.href;
                                window.location.href = 'login.html?call=' + call;
                            })

                    }
                    return false;
                }

                if (vip == 'vip') {
                    baseAjax.productVIP(function (data) {
                        _this.isVip = true;
                        _this.vipData = data.returnJSON[0];
                        console.log(data);
                    });
                }else{
                    _this.isVip = false;
                }


                baseAjax.getProductList(function (data) {
                        _this.golds = data.returnJSON;
                    }

                    //获取用户数据和用户购买记录
                );baseAjax.getUserInfoByID(userInfo.userID, function (data) {
                    console.log(data);
                    _this.user = data.returnJSON;
                    _this.showBg = true;
                    _this.payStyle.bottom = '0';
                });
            },
            goldPay: function goldPay() {

                var _this = this;
                // //验证

                var _timestamp = Math.round(new Date().getTime() / 1000);

                var _tmp = 'deviceID=' + baseAjax.getDeviceID() + '&timestemp=' + _timestamp + '&type=' + ajaxConfig.type + '&userID=' + baseAjax.getUserId() + '&key=' + signs.privateKey2;

                var _sign = hex_md5(_tmp);

                _sign = _sign.toUpperCase();

//                _this.$emit('payload');

                baseAjax.goldBuyChannel(_this.channel.channelID, 1, _timestamp, _sign, baseAjax.getUserId(), function (data) {

                    if (data) {
                        _this.payCallback();
                    } else {
                        _this.payCallbackFail();
                    }
                });
            },
            buyVip: function buyVip(gold) {

                var _this = this;

                if (gold == 'gold') {
                    //金币购买
                    var _timestamp = Math.round(new Date().getTime() / 1000);

                    var _tmp = 'deviceID=' + baseAjax.getDeviceID() + '&timestemp=' + _timestamp + '&type=' + ajaxConfig.type + '&userID=' + baseAjax.getUserId() + '&key=' + signs.privateKey2;

                    var _sign = hex_md5(_tmp);

                    _sign = _sign.toUpperCase();

//                    _this.$emit('payload');

                    baseAjax.productCoinsBuy(_this.vipData.VIPNum, _timestamp, _sign, function (data) {

                        if (data) {
                            _this.payCallback();
                        } else {
                            _this.payCallbackFail();
                        }

                    });
                } else {
                    //人民币购买


                    var _timestamp2 = Math.round(new Date().getTime() / 1000);

                    var _tmp2 = 'deviceID=' + baseAjax.getDeviceID() + '&timestemp=' + _timestamp2 + '&type=' + ajaxConfig.type + '&userID=' + baseAjax.getUserId() + '&key=' + signs.privateKey2;

                    var _sign2 = hex_md5(_tmp2);

                    _sign2 = _sign2.toUpperCase();

//                    _this.$emit('payload');

                    baseAjax.productRmbBuy(_this.vipData.VIPNum, _timestamp2, _sign2, function (data) {

                        //获取订单号
                        var _orderID = data.returnJSON.transNum;

                        baseAjax.wxJSPayChannel(_orderID, ajaxConfig.channel, _this.channel.channelName, _this.name, _this.phone, function (data2) {

                            WeixinJSBridge.invoke('getBrandWCPayRequest', JSON.parse(data2.returnJSON), function (res) {
                                //设置付费内容
                                if (res.err_msg == "get_brand_wcpay_request:ok") {
                                    _this.payCallback();
                                } else {
                                    _this.payCallbackFail();
                                }
                            });
                        });
                    });
                }
            },
            wxPay: function wxPay() {

                var _this = this;

                // //验证
                // if(base.isNull(_this.name)){
                //     layer.alert("名字不能为空");
                //     return false;
                // }
                if (base.isNull(_this.phone)) {
                    layer.alert("手机号不能为空");
                    return false;
                }

                var _timestamp = Math.round(new Date().getTime() / 1000);

                var _tmp = 'deviceID=' + baseAjax.getDeviceID() + '&timestemp=' + _timestamp + '&type=' + ajaxConfig.type + '&userID=' + baseAjax.getUserId() + '&key=' + '7english@6year';

                var _sign = hex_md5(_tmp);

                _sign = _sign.toUpperCase();

//                _this.$emit('payload');

                    baseAjax.getChannelOrder(_this.channel.channelID, 1, _timestamp, _sign, baseAjax.getUserId(), function (data) {

                        //获取订单号
                        var _orderID = data.returnJSON.transNum;

                        if(base.versions.isWeiXin){
                            baseAjax.wxJSPayChannel(_orderID, ajaxConfig.channel, _this.channel.channelName, _this.name, _this.phone, function (data2) {
                                WeixinJSBridge.invoke('getBrandWCPayRequest', JSON.parse(data2.returnJSON), function (res) {

                                    //设置付费内容
                                    if (res.err_msg == "get_brand_wcpay_request:ok") {
                                        _this.payCallback();
                                    } else {
                                        _this.payCallbackFail();
                                    }

                                });
                            });
                        }else{
                            //alipay

                            baseAjax.alipayWapChannel(_orderID,  _this.channel.channelName, _this.name, _this.phone, function (data) {

                                if (data) {
                                    _this.payCallback();
                                } else {
                                    _this.payCallbackFail();
                                }

                            })

                        }
                    });



            },
            openComment: function openComment() {

                var userInfo = base.getCookie("userInfo");

                if(!base.isNull(userInfo)){
                    userInfo = JSON.parse(base.getCookie("userInfo"));
                }

                if (base.isNull(userInfo)) {
                    if (base.versions.isWeiXin) {
                        layer.confirm('您还没有登录，前去登录吗？', {
                            btn: ['好的', '取消'] //按钮
                        }, function () {
                            //前去登录
                            var call = window.location.href;
                            window.location.href = 'wx_login.html?call=' + call;
                        }, function () {
                            //取消登录
                        });
                    } else {
                        layer.alert("请在微信里打开，使用评论功能");
                    }
                    return false;
                }

                $(".dialogBg").show(0);
                $(".commBg").show(0);
            },
            submitComment: function submitComment() {
                var _this = this;
                if (base.isNull(_this.commentVal)) {
                    layer.alert("请输入评论");
                    return false;
                }
                baseAjax.commentChannel(_this.channelID, '', _this.commentVal, function (data) {
                    if (data) {
                        layer.alert("评论成功");
                    }
                    baseAjax.commentListByID(_this.page, _this.pageSize, _this.channelID, function (data) {
                        _this.comments = data.returnJSON.indexData;
                        for (var i = 0; i < _this.comments.length; i++) {
                            if (window.localStorage.getItem(_this.channelID + "-" + _this.comments[i].commentID)) {
                                _this.comments[i].zaned = true;
                            }
                        }
                        _this.closeComment();
                    });
                });
            },
            closeComment: function closeComment() {
                $(".dialogBg").hide(0);
                $(".commBg").hide(0);
            },
            changeNav: function changeNav(type) {
                var _this = this;
                if (type == 0) _this.isDetail = true;else _this.isDetail = false;
            },
            changeLesson: function changeLesson() {},
            zan: function zan(commentID, index) {

                var _this = this;
                //赞
                baseAjax.commentPraise(commentID, function (data) {
                    if (data) {
                        _this.zaned = true;
                        _this.comments[index].zaned = true;
                        _this.comments[index].praiseCount++;

                        Vue.set(_this.comments, index, _this.comments[index]);
                        window.localStorage.setItem(_this.channelID + "-" + commentID, true);
                    }
                });
            }
        }, _defineProperty(_methods, "myBack", function myBack() {
            window.history.go(-1);
        }), _defineProperty(_methods, "payIng", function payIng() {
            this.loading = true;
        }),
            _defineProperty(_methods, "payCallback", function payCallback() {
            layer.alert('购买成功');
            var _this = this;
            _this.buyed = true;
            //更新用户数据，查询是否为vip
//            var userInfo = JSON.parse(base.getCookie("userInfo"));

                var userInfo = base.getCookie("userInfo");

                if(!base.isNull(userInfo)){
                    userInfo = JSON.parse(base.getCookie("userInfo"));
                }

            baseAjax.getUserInfoByID(userInfo.userID, function (data) {
                _this.user = data.returnJSON;
                if (_this.user.vip > 0) {
                    _this.isVip = true;
                }
            });
            _this.loading = false;
            _this.closePay();
        }), _defineProperty(_methods, "payCallbackFail", function payCallbackFail() {
            layer.alert('购买失败');
            this.loading = false;
            this.closePay();
        }), _defineProperty(_methods, "buyLesson", function buyLesson(vip) {
            if (vip == 'vip') {
                this.openPay('vip');
            } else {
                this.openPay();
            }
        }), _defineProperty(_methods, "playLesson", function playLesson(item, index) {

            var _this = this;
            var _flag = false;

            if (_this.channel.channelType == 1) {
                window.location.href = "lesson_play.html?lessonID=" + item.lessonID;
            } else {

                _this.currentVideo = index;

                if (!base.isNull(item.videoURL) || !base.isNull(item.videoURL1)) {
                    //如果一个值不为null
                    if (!base.isNull(item.videoURL)) {
                        if (item.videoURL.indexOf(".m3u8") != -1) {
                            var _vUrl = signs.getUrlSign(item.videoURL, 'A');
                            _this.videoUrl = _vUrl;
                            _this.isM3u8 = true;
                            _flag = true;
                        }
                    }
                    if (!base.isNull(item.videoURL1)) {
                        if (item.videoURL1.indexOf(".m3u8") != -1) {
                            var _vUrl2 = signs.getUrlSign(item.videoURL1, 'A');
                            _this.videoUrl = _vUrl2;
                            _this.isM3u8 = true;
                            _flag = true;
                        }
                    }
                } else {
                    _this.isM3u8 = false;
                    _this.videoHtml = item.shareVideoURL;
                }

                if (_flag) {
                    //m3u8
                } else {
                    _this.isM3u8 = false;
                    _this.videoHtml = item.shareVideoURL;
                }

                _this.isPlay = true;
            }
        }), _methods),
        created: function created() {

            var _this = this;

            layer.closeAll();

            _this.channelID = base.getParmar("channelID");

            _this.width = $(window).width();

            if (base.isNull(_this.channelID)) {
                layer.alert("缺少频道ID");
                return false;
            }

            _this.timerID = setInterval(function () {

                _this.timer++;

                var paymentNo = base.getCookie('paymentNo');

                if (!base.isNull(paymentNo)) {

                    console.log(paymentNo)

                    baseAjax.alipayResult(paymentNo, function (data) {

                        console.log(data);


                        if (data) {

                            console.log(data);

                            clearInterval(_this.timerID);

                            base.setCookie('paymentNo',null);

                            //充值成功
                            _this.showResult = true;
                            _this.state = true;
//                            _this.infoMsg = '充值成功';
                            layer.alert("充值成功");

                            if (_this.isVip) {
                                _this.buyVip('gold');
                            } else {
                                _this.goldPay();
                            }
                            _this.closeRecharge();

                        }else{

                            base.setCookie('paymentNo',null);

                            //充值失败
//                            _this.infoMsg = '充值失败';
                            layer.alert("充值失败");
                        }
                    });

                    if (_this.timer >= 600) {
                        baseAjax.alipayResult(paymentNo, function (data) {
                            if (data) {
                                clearInterval(_this.timerID);

                                base.setCookie('paymentNo',null);

                                //充值成功
                                _this.showResult = true;
                                _this.state = false;
//                                _this.infoMsg = '充值成功';
                                layer.alert("充值成功");

                            } else {

                                base.setCookie('paymentNo',null);

                                //充值失败
                                _this.showResult = true;
                                _this.state = false;
//                                _this.infoMsg = '操作超时';
                                layer.alert("操作超时");
                            }
                        });
                    }
                }
            }, 1000);

            //判断是否为付费频道

            baseAjax.getLessonsByChannelID(_this.channelID, function (data2) {

                    _this.channel = data2.extendInfo;
                    _this.playList = data2.returnJSON;

                    if (_this.channel.isBuy == true) {

                        var userInfo = base.getCookie("userInfo");

                        if(base.isNull(userInfo)){
                            //未登录

                            setTimeout(function () {
                                _this.showLoader = false;
                                $(".lesson_detail_page_content").removeClass("hidden");
                            }, ajaxConfig.lazy);
                        }else{
                            userInfo = JSON.parse(base.getCookie("userInfo"));
                        }

                        if (base.isNull(userInfo)) {
                            //未登录

                            setTimeout(function () {
                                _this.showLoader = false;
                                $(".lesson_detail_page_content").removeClass("hidden");
                            }, ajaxConfig.lazy);
                        } else {
                            //获取用户数据和用户购买记录
                            baseAjax.getUserInfoByID(userInfo.userID, function (data) {
                                _this.user = data.returnJSON;

                                if (_this.user.vip > 0) {
                                    _this.buyed = true;
                                    _this.isVip = true;
                                }
                            });

                            baseAjax.getBuyList(userInfo.userID, function (data) {
                                //判断是否付费

                                var buyed = data.returnJSON;

                                for (var i = 0; i < buyed.length; i++) {
                                    if (buyed[i].product == _this.channelID) {
                                        _this.buyed = true;
                                    }
                                }

                                setTimeout(function () {
                                    _this.showLoader = false;
                                    $(".lesson_detail_page_content").removeClass("hidden");
                                }, ajaxConfig.lazy);
                            });
                        }
                    } else {

                        _this.buyed = true;

                        setTimeout(function () {
                            _this.showLoader = false;
                            $(".lesson_detail_page_content").removeClass("hidden");
                        }, ajaxConfig.lazy);
                    }
                }

                //获取评论

            );baseAjax.commentListByID(_this.page, _this.pageSize, _this.channelID, function (data) {
                _this.comments = data.returnJSON.indexData;
                for (var i = 0; i < _this.comments.length; i++) {
                    if (window.localStorage.getItem(_this.channelID + "-" + _this.comments[i].commentID)) {
                        _this.comments[i].zaned = true;
                    }
                }
            });


        }
    });

    $(function () {
        var isPageHide = false;
        window.addEventListener('pageshow', function () {
            if (isPageHide) {
                var _this = vm;

                layer.closeAll();

                _this.channelID = base.getParmar("channelID");

                _this.width = $(window).width();

                if (base.isNull(_this.channelID)) {
                    layer.alert("缺少频道ID");
                    return false;
                }

                _this.timerID = setInterval(function () {

                    _this.timer++;

                    var paymentNo = base.getCookie('paymentNo');

                    if (!base.isNull(paymentNo)) {

                        console.log(paymentNo)

                        baseAjax.alipayResult(paymentNo, function (data) {

                            console.log(data);


                            if (data) {

                                console.log(data);

                                clearInterval(_this.timerID);

                                base.setCookie('paymentNo',null);

                                //充值成功
                                _this.showResult = true;
                                _this.state = true;
//                            _this.infoMsg = '充值成功';
                                layer.alert("充值成功");

                                if (_this.isVip) {
                                    _this.buyVip('gold');
                                } else {
                                    _this.goldPay();
                                }
                                _this.closeRecharge();

                            }else{

                                base.setCookie('paymentNo',null);

                                //充值失败
//                            _this.infoMsg = '充值失败';
                                layer.alert("充值失败");
                            }
                        });

                        if (_this.timer >= 60) {
                            baseAjax.alipayResult(paymentNo, function (data) {
                                if (data) {
                                    clearInterval(_this.timerID);

                                    base.setCookie('paymentNo',null);

                                    //充值成功
                                    _this.showResult = true;
                                    _this.state = false;
//                                _this.infoMsg = '充值成功';
                                    layer.alert("充值成功");

                                } else {

                                    base.setCookie('paymentNo',null);

                                    //充值失败
                                    _this.showResult = true;
                                    _this.state = false;
//                                _this.infoMsg = '操作超时';
                                    layer.alert("操作超时");
                                }
                            });
                        }
                    }
                }, 1000);

                //判断是否为付费频道

                baseAjax.getLessonsByChannelID(_this.channelID, function (data2) {

                        _this.channel = data2.extendInfo;
                        _this.playList = data2.returnJSON;

                        if (_this.channel.isBuy == true) {

                            var userInfo = base.getCookie("userInfo");

                            if(base.isNull(userInfo)){
                                //未登录

                                setTimeout(function () {
                                    _this.showLoader = false;
                                    $(".lesson_detail_page_content").removeClass("hidden");
                                }, ajaxConfig.lazy);
                            }else{
                                userInfo = JSON.parse(base.getCookie("userInfo"));
                            }

                            if (base.isNull(userInfo)) {
                                //未登录

                                setTimeout(function () {
                                    _this.showLoader = false;
                                    $(".lesson_detail_page_content").removeClass("hidden");
                                }, ajaxConfig.lazy);
                            } else {
                                //获取用户数据和用户购买记录
                                baseAjax.getUserInfoByID(userInfo.userID, function (data) {
                                    _this.user = data.returnJSON;

                                    if (_this.user.vip > 0) {
                                        _this.buyed = true;
                                        _this.isVip = true;
                                    }
                                });

                                baseAjax.getBuyList(userInfo.userID, function (data) {
                                    //判断是否付费

                                    var buyed = data.returnJSON;

                                    for (var i = 0; i < buyed.length; i++) {
                                        if (buyed[i].product == _this.channelID) {
                                            _this.buyed = true;
                                        }
                                    }

                                    setTimeout(function () {
                                        _this.showLoader = false;
                                        $(".lesson_detail_page_content").removeClass("hidden");
                                    }, ajaxConfig.lazy);
                                });
                            }
                        } else {

                            _this.buyed = true;

                            setTimeout(function () {
                                _this.showLoader = false;
                                $(".lesson_detail_page_content").removeClass("hidden");
                            }, ajaxConfig.lazy);
                        }
                    }

                    //获取评论

                );baseAjax.commentListByID(_this.page, _this.pageSize, _this.channelID, function (data) {
                    _this.comments = data.returnJSON.indexData;
                    for (var i = 0; i < _this.comments.length; i++) {
                        if (window.localStorage.getItem(_this.channelID + "-" + _this.comments[i].commentID)) {
                            _this.comments[i].zaned = true;
                        }
                    }
                });

            }
        });
        window.addEventListener('pagehide', function () {
            isPageHide = true;
        });
    })


</script>

</body>
</html>
